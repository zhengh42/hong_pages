<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    
    <title>A typical RNASeq analysis - LittleBitofData</title>
    <meta property="og:title" content="A typical RNASeq analysis - LittleBitofData">
    

    
      
    

    

    
    


<link href='//cdn.bootcss.com/highlight.js/9.12.0/styles/github.min.css' rel='stylesheet' type='text/css' />



    <link rel="stylesheet" href="/css/style.css" />
    <link rel="stylesheet" href="/css/fonts.css" />
    
<link rel="stylesheet" href="/css/custom.css" />

  </head>

  
  <body class="en">
    <header class="masthead">
      

<h1><a href="/"><img src="/images/logo.jpg" alt="Hong Zheng" /></a></h1>



      <nav class="menu">
        <input id="menu-check" type="checkbox" />
        <label id="menu-label" for="menu-check" class="unselectable">
          <span class="icon close-icon">✕</span>
          <span class="icon open-icon">☰</span>
          <span class="text">Menu</span>
        </label>
        <ul>
        
        
        <li><a href="/">Home</a></li>
        
        <li><a href="/en/about/">About</a></li>
        
        <li><a href="/en/">Blog</a></li>
        
        <li><a href="/en/vitae/">Vitae</a></li>
        
        <li><a href="/tags/">Tags 标签</a></li>
        
        <li><a href="/categories/">Categories 分类</a></li>
        
        <li><a href="/cn/">中文</a></li>
        
        

<li class="meu-extra"></li>



<li><a href="https://github.com/zhengh42/hong_pages/tree/master/content/en/2017-09-18-RNASeq_pipeline.md" target="_blank">Edit this page</a></li>


<li><a href="/en/index.xml" type="application/rss+xml" title="RSS feed">Subscribe</a></li>

<li><a href="http://creativecommons.org/licenses/by-nc-sa/4.0/" title="Attribution-NonCommercial-ShareAlike 4.0 International">License</a></li>


        </ul>
      </nav>
    </header>

    <article class="main">
      <header class="title">
      
<h1>A typical RNASeq analysis</h1>


<h3>Hong Zheng / 
2017-09-18</h3>

<hr>


      </header>





<blockquote>
<p>This is a <strong>typical</strong> RNASeq analysis pipeline, not <strong>atypical</strong>.</p>
</blockquote>

<h2 id="purpose">Purpose</h2>

<p>Given RNASeq data from two group of samples (sequenced from mice), control and treatment, find out the differentially expressed genes.</p>

<p>Scripts can also be found in <a href="https://github.com/zhengh42/RNASeq_MM">https://github.com/zhengh42/RNASeq_MM</a>.</p>

<h2 id="download-reference-and-prepare-index">Download reference and prepare index</h2>

<pre><code>#######
# These steps are performed in linux/bash, in reference/ directory
# Script location: reference/run_download_index.sh
# Kallisto and Salmon are from pre-built Docker images. Scripts for building the images can be found in https://github.com/zhengh42/Dockerfiles 
#######

#######
# Download from Gencode release M15
#######
wget ftp://ftp.sanger.ac.uk/pub/gencode/Gencode_mouse/release_M15/GRCm38.primary_assembly.genome.fa.gz
wget ftp://ftp.sanger.ac.uk/pub/gencode/Gencode_mouse/release_M15/gencode.vM15.annotation.gtf.gz
wget ftp://ftp.sanger.ac.uk/pub/gencode/Gencode_mouse/release_M15/gencode.vM15.transcripts.fa.gz
gzip -d *.gz

#######
# Stats of Gencode release M15
#######
# Number of genes: 52550
less gencode.vM15.annotation.gtf | awk '$3==&quot;gene&quot;' | wc -l
# Number of transcript: 131100
less gencode.vM15.annotation.gtf | awk '$3==&quot;transcript&quot;' | wc -l
less gencode.vM15.transcripts.fa | grep '^&gt;' | wc -l
# Get gene name and type
less gencode.vM15.annotation.gtf  | awk '$3==&quot;gene&quot;' | cut -f9 | awk '{print $2,$4,$6}' | sed 's/[&quot;;]//g;s/\s\+/\t/g' | sed '1i geneid\tgenetype\tgenename' &gt; gene.info

#######
# Generate transcript to gene mapping file
#######
less gencode.vM15.transcripts.fa | egrep '^&gt;' | sed 's/^&gt;//' | awk 'OFS=&quot;\t&quot;{print $0,$0}' | sed 's/|/\t/;s/|/\t/' | awk 'OFS=&quot;\t&quot;{print $4,$2}' &gt; tx2gene.txt

transcripts_fasta=gencode.vM15.transcripts.fa
#######
# Kallisto index
#######
docker run -v $PWD:/mnt zhengh42/kallisto:0.43.1 kallisto index -i /mnt/M15.gencode.kallisto.idx /mnt/$transcripts_fasta

#######
# Salmon index
#######
docker run -v $PWD:/mnt zhengh42/salmon:0.8.2 salmon index -i /mnt/M15.gencode.salmon.idx -t /mnt/$transcripts_fasta
</code></pre>

<h2 id="qc-and-transcript-level-expression-quantification">QC and transcript-level expression quantification</h2>

<pre><code>#######
# These steps are performed in linux/bash, in scripts/ directory
# Trim-galore is from pre-built Docker images. Scripts for building the images can be found in https://github.com/zhengh42/Dockerfiles
# Script location: scripts/run_indiv.sh
# How to run:
# ./run_indiv.sh sham1 Raw_sham1
# ./run_indiv.sh sham2 Raw_sham2
# ./run_indiv.sh sham3 Raw_sham3
# ./run_indiv.sh WT_Ang1 Raw_WT_Ang1
# ./run_indiv.sh WT_Ang2 Raw_WT_Ang2
# ./run_indiv.sh WT_Ang3 Raw_WT_Ang3
#######

#######
# Arguments setup
#######
id=$1
id2=$2
raw_dir=/srv/gevaertlab/data/Hong/RNASeq/hb/Reads
work_dir=/srv/gevaertlab/data/Hong/RNASeq/hb/RNASeq_MM_HB/
ref_dir=$work_dir/reference

#######
# QC with trim-galore and fastqc
#######
docker run -v $raw_dir:/home zhengh42/trim-galore:0.4.4  \
        trim_galore -q 15  --stringency 3 --gzip --length 15 --paired 
        /home/$id/${id2}_1.fq.gz /home/$id/${id2}_2.fq.gz --fastqc --output_dir /home 
        1&gt; ../logs/$id.trim_galore.log 2&gt;&amp;1

#######
# Get the stand-specific information of the reads
# In the log file of salmon output: Automatically detected most likely library type as ISR
#######
zcat $raw_dir/${id2}_1_val_1.fq.gz | head -n 400000 | gzip &gt; $raw_dir/${id2}_test_1.fq.gz
zcat $raw_dir/${id2}_2_val_2.fq.gz | head -n 400000 | gzip &gt; $raw_dir/${id2}_test_2.fq.gz
docker run -v $raw_dir:/home/seq -v $ref_dir:/home/ref -v $work_dir/results/salmon:/home/out  \
        zhengh42/salmon:0.8.2 \
        salmon quant -i /home/ref/M15.gencode.salmon.idx -l A \
        -o /home/out/$id.test -1 /home/seq/${id2}_test_1.fq.gz -2 /home/seq/${id2}_test_2.fq.gz \
        1&gt; ../logs/$id.salmon.log 2&gt;&amp;1

#######
# Get transcript level expression estimate using Kallisto
# Since the library type is ISR, --rf-stranded argument is specified
# More information on the library type and strand information, see http://fishycat.netlify.com/en/2017/08/strandness_in_rnaseq/
#######
docker run -v $raw_dir:/home/seq -v $ref_dir:/home/ref -v $work_dir/results/kallisto:/home/out \
        zhengh42/kallisto:0.43.1 \
        kallisto quant -i /home/ref/M15.gencode.kallisto.idx \
        -o /home/out/$id /home/seq/${id2}_1_val_1.fq.gz /home/seq/${id2}_2_val_2.fq.gz  \
        -b 100 --rf-stranded --fusion  1&gt; ../logs/$id.kallisto.log 2&gt;&amp;1
</code></pre>

<h2 id="differential-expression-analysis">Differential expression analysis</h2>

<pre><code>#######
# The following steps are performed in R, in scripts/ directory
#######

#######
# Load required packages, set up directory, read in files
#######
library(readr)
library(tximport)
require(&quot;knitr&quot;)
require(DESeq2) # version 1.16.1
require(IHW)
require(dplyr)
require(ComplexHeatmap)
require(vsn)
require(RColorBrewer)
require(ggplot2)

work_dir&lt;- &quot;/srv/gevaertlab/data/Hong/RNASeq/hb/RNASeq_MM_HB/&quot;
opts_knit$set(root.dir = work_dir)
sampleID &lt;- scan(paste0(work_dir,&quot;sampleID&quot;),what=&quot;character&quot;,quiet=TRUE)
geneinfo&lt;-read.table(paste0(work_dir,&quot;reference/gene.info&quot;),head=T,sep = &quot;\t&quot;)

#######
# Get gene-level expression from transcript level results of Kallisto
#######
files.kallisto &lt;- file.path(paste0(work_dir,&quot;results/kallisto&quot;),sampleID,&quot;abundance.tsv&quot;)
all(file.exists(files.kallisto))
names(files.kallisto)&lt;- sampleID
tx2gene&lt;-read.table(paste0(work_dir,&quot;reference/tx2gene.txt&quot;))
Kallisto.txim &lt;- tximport(files.kallisto,type=&quot;kallisto&quot;,tx2gene = tx2gene)
write.csv(Kallisto.txim,file=paste0(work_dir, &quot;results/kallisto/Kallisto.txim.txt&quot;),row.names = T)
</code></pre>

<h3 id="1-deseq2">1. DESeq2</h3>

<pre><code>#######
# Read in data and pre-filtering
#######
sampleTable=data.frame(condition = factor(rep(c(&quot;wt-sham&quot;,&quot;wt-ang&quot;),each=3)))
rownames(sampleTable) = colnames(Kallisto.txim$counts)
dds&lt;- DESeqDataSetFromTximport(Kallisto.txim,sampleTable,~condition)
dds$condition &lt;- factor(dds$condition, levels = c(&quot;wt-sham&quot;,&quot;wt-ang&quot;))
dim(dds) #[1] 52550     6
# Only genes with at least two counts across the samples were kept
dds &lt;- dds[ rowSums(counts(dds)) &gt; 1, ]
dim(dds) #[1] 31043     6

#######
# Generate DESeq object
#######
dds &lt;- DESeq(dds)

#######
# Different approaches of tranformation. DESeq uses regularized log transformation as default.
#######
# Shifted logarithm transformation, log2(n + 1), has elevated standard deviation in the lower count range.
ntd &lt;- normTransform(dds)
meanSdPlot(assay(ntd))
</code></pre>

<p><img src="https://github.com/zhengh42/myfiles/blob/master/figures/201709rnaseqmm/data_transformation-1.png?raw=true" alt="" /></p>

<pre><code># Regularized log transformation, less elevated standard deviation in the lower count range.
rld &lt;- rlog(dds, blind=FALSE)
meanSdPlot(assay(rld))
</code></pre>

<p><img src="https://github.com/zhengh42/myfiles/blob/master/figures/201709rnaseqmm/data_transformation-2.png?raw=true" alt="" /></p>

<pre><code># Variance stabilizing transformation.It may over-correct standard deviation and mask true differences due to the experimental conditions.
vsd &lt;- varianceStabilizingTransformation(dds, blind=FALSE)
meanSdPlot(assay(vsd))
</code></pre>

<p><img src="https://github.com/zhengh42/myfiles/blob/master/figures/201709rnaseqmm/data_transformation-3.png?raw=true" alt="" /></p>

<pre><code>#######
# Data quality assessment by sample clustering and visualization
#######
# Sample clustering based on first 400 highly-expressed genes
select &lt;- order(rowMeans(counts(dds,normalized=TRUE)),
                decreasing=TRUE)[1:400]

p&lt;- Heatmap(assay(rld)[select,],
        clustering_distance_rows = &quot;euclidean&quot;, clustering_distance_columns = &quot;euclidean&quot;,
        clustering_method_rows  = &quot;average&quot;,clustering_method_columns  = &quot;average&quot;,
        show_row_names =F,
        name=&quot;distance&quot;,
        column_names_gp = gpar(fontsize = 9)
             )
draw(p,newpage = T)
</code></pre>

<p><img src="https://github.com/zhengh42/myfiles/blob/master/figures/201709rnaseqmm/heatmap-1.png?raw=true" alt="" /></p>

<pre><code>### Heatmap of the sample-to-sample distances
sampleDists &lt;- dist(t(assay(rld)))
sampleDistMatrix &lt;- as.matrix(sampleDists)
colnames(sampleDistMatrix) &lt;- NULL

colors &lt;- colorRampPalette( rev(brewer.pal(9, &quot;Oranges&quot;)) )(255)
p&lt;- Heatmap(sampleDistMatrix,
        clustering_distance_rows = &quot;euclidean&quot;, clustering_distance_columns = &quot;euclidean&quot;,
        clustering_method_rows  = &quot;average&quot;,clustering_method_columns  = &quot;average&quot;,
        col=colors,
        name=&quot;Distance&quot;,
        column_names_gp = gpar(fontsize = 9)
             )
draw(p,newpage = T)
</code></pre>

<p><img src="https://github.com/zhengh42/myfiles/blob/master/figures/201709rnaseqmm/heatmap-2.png?raw=true" alt="" /></p>

<pre><code># PCA plot
pcaData &lt;- plotPCA(rld, intgroup=c(&quot;condition&quot;), returnData=TRUE)
percentVar &lt;- round(100 * attr(pcaData, &quot;percentVar&quot;))
ggplot(pcaData, aes(PC1, PC2, color=condition,shape=name)) +
  geom_point(size=3) +
  xlab(paste0(&quot;PC1: &quot;,percentVar[1],&quot;% variance&quot;)) +
  ylab(paste0(&quot;PC2: &quot;,percentVar[2],&quot;% variance&quot;)) + 
  coord_fixed()
</code></pre>

<p><img src="https://github.com/zhengh42/myfiles/blob/master/figures/201709rnaseqmm/heatmap-3.png?raw=true" alt="" /></p>

<p><strong>QC summary</strong></p>

<p>From the clustering and visualization plots above, we can see that sham1
and sham2 always cluster together, as well as Ang1 and Ang2. However,
instead of clustering with sham group, sham3 always clusters with Ang
group. Is there any problem with this sample?</p>

<p>To accurately measure fold change, two versions of differential
expression analysis was performed, one with sham3 and one with out.</p>

<p><strong>Differential expression analysis with all samples</strong></p>

<pre><code>#######
# Differential expression analysis
#######
res &lt;- results(dds)
# Get moderated and shrunken log2 fold changes. No effect on p values
resLFC &lt;- lfcShrink(dds, coef=2, res=res)

#######
# MA plot
#######
plotMA(res, ylim=c(-2,2))
</code></pre>

<p><img src="https://github.com/zhengh42/myfiles/blob/master/figures/201709rnaseqmm/MAPlot-1.png?raw=true" alt="" /></p>

<pre><code>plotMA(resLFC, ylim=c(-2,2))
</code></pre>

<p><img src="https://github.com/zhengh42/myfiles/blob/master/figures/201709rnaseqmm/MAPlot-2.png?raw=true" alt="" /></p>

<pre><code>#######
# Choose top differentially-expressed genes
#######
# By default, DESeq performs independent filtering based on the mean of normalized counts for each gene, optimizing the number of genes which will have an adjusted p value below a given FDR cutoff (default 0.1). Using alpha to change the threshold: results(dds, alpha=0.2)
summary(res)

## 
## out of 31043 with nonzero total read count
## adjusted p-value &lt; 0.1
## LFC &gt; 0 (up)     : 365, 1.2% 
## LFC &lt; 0 (down)   : 444, 1.4% 
## outliers [1]     : 15, 0.048% 
## low counts [2]   : 12635, 41% 
## (mean count &lt; 14)
## [1] see 'cooksCutoff' argument of ?results
## [2] see 'independentFiltering' argument of ?results

# Filtering by Independent Hypothesis Weighting
resIHW &lt;- results(dds, filterFun=ihw)
summary(resIHW)

## 
## out of 31043 with nonzero total read count
## adjusted p-value &lt; 0.1
## LFC &gt; 0 (up)     : 404, 1.3% 
## LFC &lt; 0 (down)   : 439, 1.4% 
## outliers [1]     : 15, 0.048% 
## [1] see 'cooksCutoff' argument of ?results
## [2] see metadata(res)$ihwResult on hypothesis weighting
</code></pre>

<p>There are 809 genes with adjusted p value less than 0.1 using default
independent filtering.</p>

<p>There are 843 genes with adjusted p value less than 0.1 using
independent hypothesis weighting filtering.</p>

<pre><code>######
# Write results
#######
DESeq.gene.out &lt;- as.data.frame(res)
DESeq.gene.out$log2FoldChange_lfc &lt;- resLFC$log2FoldChange
DESeq.gene.out$padj_IHW &lt;- resIHW$padj
DESeq.gene.out$geneid &lt;- rownames(res)
DESeq.geneanno.out &lt;- merge(x=DESeq.gene.out,y=geneinfo,by = &quot;geneid&quot;, all.x = TRUE)

Kallisto.txim.abundance &lt;- as.data.frame(Kallisto.txim$abundance)
colnames(Kallisto.txim.abundance) &lt;- gsub(&quot;^&quot;,&quot;TPM.&quot;,colnames(Kallisto.txim.abundance))
Kallisto.txim.abundance$geneid&lt;-rownames(Kallisto.txim.abundance)
Kallisto.txim.counts &lt;- as.data.frame(Kallisto.txim$counts)
colnames(Kallisto.txim.counts) &lt;- gsub(&quot;^&quot;,&quot;counts.&quot;,colnames(Kallisto.txim.counts))
Kallisto.txim.counts$geneid&lt;-rownames(Kallisto.txim.counts)

DESeq.geneanno.out&lt;-merge(x=DESeq.geneanno.out,y=Kallisto.txim.abundance,by = &quot;geneid&quot;, all.x = TRUE)
DESeq.geneanno.out&lt;-merge(x=DESeq.geneanno.out,y=Kallisto.txim.counts,by = &quot;geneid&quot;, all.x = TRUE)
DESeq.geneanno.out.ordered&lt;-DESeq.geneanno.out[order(DESeq.geneanno.out$padj_IHW),]

# What are the types of the genes?
table(DESeq.geneanno.out.ordered$genetype)

## 
##           3prime_overlapping_ncRNA                      antisense_RNA 
##                                  1                               1684 
##      bidirectional_promoter_lncRNA                          IG_C_gene 
##                                107                                 11 
##                    IG_C_pseudogene                          IG_D_gene 
##                                  0                                  0 
##                    IG_D_pseudogene                          IG_J_gene 
##                                  0                                  9 
##                         IG_LV_gene                      IG_pseudogene 
##                                  0                                  0 
##                          IG_V_gene                    IG_V_pseudogene 
##                                111                                  2 
##                            lincRNA                       macro_lncRNA 
##                               2763                                  0 
##                              miRNA                           misc_RNA 
##                                811                                173 
##                            Mt_rRNA                            Mt_tRNA 
##                                  2                                 22 
##             polymorphic_pseudogene               processed_pseudogene 
##                                 23                               2306 
##               processed_transcript                     protein_coding 
##                                626                              18179 
##                         pseudogene                           ribozyme 
##                                 49                                  9 
##                               rRNA                             scaRNA 
##                                 31                                 29 
##                              scRNA                     sense_intronic 
##                                  1                                284 
##                  sense_overlapping                             snoRNA 
##                                 20                                323 
##                              snRNA                               sRNA 
##                                299                                  1 
##                                TEC                          TR_C_gene 
##                               2510                                  7 
##                          TR_D_gene                          TR_J_gene 
##                                  0                                 46 
##                    TR_J_pseudogene                          TR_V_gene 
##                                  3                                 29 
##                    TR_V_pseudogene   transcribed_processed_pseudogene 
##                                  2                                159 
##     transcribed_unitary_pseudogene transcribed_unprocessed_pseudogene 
##                                 10                                128 
##                 unitary_pseudogene             unprocessed_pseudogene 
##                                  4                                269

# Get lncRNA genes
lncrna&lt;-c(&quot;lincRNA&quot;,&quot;antisense_RNA&quot;,&quot;sense_intronic&quot;,&quot;sense_overlapping&quot;,&quot;TEC&quot;)
DESeq.geneanno.out.ordered.lncRNA &lt;- DESeq.geneanno.out.ordered %&gt;% filter(genetype %in% lncrna)

write.table(DESeq.geneanno.out.ordered.lncRNA,file = &quot;DESeq.geneanno.out.ordered.lncRNA.txt&quot;,sep=&quot;\t&quot;,quote = F,row.names = F)
write.table(DESeq.geneanno.out.ordered,file = &quot;DESeq.geneanno.out.ordered.txt&quot;,sep=&quot;\t&quot;,quote = F,row.names = F)
</code></pre>

<p><strong>Differential expression analysis without sham3</strong></p>

<pre><code># Start with Kallisto data import
files.kallisto_a &lt;- files.kallisto[-which(names(files.kallisto) %in% c(&quot;sham3&quot;) )]
Kallisto.txim_a &lt;- tximport(files.kallisto_a,type=&quot;kallisto&quot;,tx2gene = tx2gene)

# DESeq
sampleTable_a &lt;- sampleTable[-which(rownames(sampleTable)  %in% c(&quot;sham3&quot;)),,F]
dds_a&lt;- DESeqDataSetFromTximport(Kallisto.txim_a,sampleTable_a,~condition)

dds_a$condition &lt;- factor(dds_a$condition, levels = c(&quot;wt-sham&quot;,&quot;wt-ang&quot;))
dim(dds_a) #[1] 52550     6
# Only genes with at least two counts across the samples were kept
dds_a &lt;- dds_a[ rowSums(counts(dds_a)) &gt; 1, ]
dim(dds_a) #[1] 30796     5

dds_a &lt;- DESeq(dds_a)
res_a &lt;- results(dds_a)
resLFC_a &lt;- lfcShrink(dds_a, coef=2, res=res_a)

#######
# MA plot
#######
plotMA(res_a, ylim=c(-2,2))
</code></pre>

<p><img src="https://github.com/zhengh42/myfiles/blob/master/figures/201709rnaseqmm/MAPlot_a-1.png?raw=true" alt="" /></p>

<pre><code>plotMA(resLFC_a, ylim=c(-2,2))
</code></pre>

<p><img src="https://github.com/zhengh42/myfiles/blob/master/figures/201709rnaseqmm/MAPlot_a-2.png?raw=true" alt="" /></p>

<pre><code># Choose top differentially-expressed genes
summary(res_a)

## 
## out of 30796 with nonzero total read count
## adjusted p-value &lt; 0.1
## LFC &gt; 0 (up)     : 1251, 4.1% 
## LFC &lt; 0 (down)   : 1102, 3.6% 
## outliers [1]     : 0, 0% 
## low counts [2]   : 14330, 47% 
## (mean count &lt; 28)
## [1] see 'cooksCutoff' argument of ?results
## [2] see 'independentFiltering' argument of ?results

# Filtering by Independent Hypothesis Weighting
resIHW_a &lt;- results(dds_a, filterFun=ihw)
summary(resIHW_a)

## 
## out of 30796 with nonzero total read count
## adjusted p-value &lt; 0.1
## LFC &gt; 0 (up)     : 1342, 4.4% 
## LFC &lt; 0 (down)   : 1108, 3.6% 
## outliers [1]     : 0, 0% 
## [1] see 'cooksCutoff' argument of ?results
## [2] see metadata(res)$ihwResult on hypothesis weighting
</code></pre>

<p>There are 2353 genes with adjusted p value less than 0.1 using default
independent filtering.</p>

<p>There are 2450 genes with adjusted p value less than 0.1 using
independent hypothesis weighting filtering.</p>

<pre><code># Write results
DESeq.gene.out_a &lt;- as.data.frame(res_a)
DESeq.gene.out_a$log2FoldChange_lfc &lt;- resLFC_a$log2FoldChange
DESeq.gene.out_a$padj_IHW &lt;- resIHW_a$padj
DESeq.gene.out_a$geneid &lt;- rownames(res_a)
DESeq.geneanno.out_a &lt;- merge(x=DESeq.gene.out_a,y=geneinfo,by = &quot;geneid&quot;, all.x = TRUE)

DESeq.geneanno.out_a&lt;-merge(x=DESeq.geneanno.out_a,y=Kallisto.txim.abundance,by = &quot;geneid&quot;, all.x = TRUE)
DESeq.geneanno.out_a&lt;-merge(x=DESeq.geneanno.out_a,y=Kallisto.txim.counts,by = &quot;geneid&quot;, all.x = TRUE)
DESeq.geneanno.out.ordered_a&lt;-DESeq.geneanno.out_a[order(DESeq.geneanno.out_a$padj_IHW),]

# What are the types of the genes?
table(DESeq.geneanno.out.ordered_a$genetype)

## 
##           3prime_overlapping_ncRNA                      antisense_RNA 
##                                  1                               1654 
##      bidirectional_promoter_lncRNA                          IG_C_gene 
##                                107                                 11 
##                    IG_C_pseudogene                          IG_D_gene 
##                                  0                                  0 
##                    IG_D_pseudogene                          IG_J_gene 
##                                  0                                  8 
##                         IG_LV_gene                      IG_pseudogene 
##                                  0                                  0 
##                          IG_V_gene                    IG_V_pseudogene 
##                                105                                  2 
##                            lincRNA                       macro_lncRNA 
##                               2736                                  0 
##                              miRNA                           misc_RNA 
##                                799                                171 
##                            Mt_rRNA                            Mt_tRNA 
##                                  2                                 21 
##             polymorphic_pseudogene               processed_pseudogene 
##                                 22                               2242 
##               processed_transcript                     protein_coding 
##                                623                              18117 
##                         pseudogene                           ribozyme 
##                                 48                                  9 
##                               rRNA                             scaRNA 
##                                 31                                 29 
##                              scRNA                     sense_intronic 
##                                  1                                284 
##                  sense_overlapping                             snoRNA 
##                                 20                                320 
##                              snRNA                               sRNA 
##                                294                                  1 
##                                TEC                          TR_C_gene 
##                               2498                                  7 
##                          TR_D_gene                          TR_J_gene 
##                                  0                                 45 
##                    TR_J_pseudogene                          TR_V_gene 
##                                  3                                 27 
##                    TR_V_pseudogene   transcribed_processed_pseudogene 
##                                  2                                158 
##     transcribed_unitary_pseudogene transcribed_unprocessed_pseudogene 
##                                 10                                125 
##                 unitary_pseudogene             unprocessed_pseudogene 
##                                  3                                260

# Get lncRNA genes
lncrna&lt;-c(&quot;lincRNA&quot;,&quot;antisense_RNA&quot;,&quot;sense_intronic&quot;,&quot;sense_overlapping&quot;,&quot;TEC&quot;)
DESeq.geneanno.out.ordered.lncRNA_a &lt;- DESeq.geneanno.out.ordered_a %&gt;% filter(genetype %in% lncrna)

write.table(DESeq.geneanno.out.ordered.lncRNA_a,file = &quot;DESeq.geneanno.out.ordered.lncRNA.wosham3.txt&quot;,sep=&quot;\t&quot;,quote = F,row.names = F)
write.table(DESeq.geneanno.out.ordered_a,file = &quot;DESeq.geneanno.out.ordered.wosham3.txt&quot;,sep=&quot;\t&quot;,quote = F,row.names = F)
</code></pre>

<p><strong>Easy report</strong></p>

<pre><code>#######
# This report is based on DESeq analysis of all samples, default filtering. See ./reports for details.
#######
des2Report &lt;- HTMLReport(shortName = 'RNAseq_analysis_with_DESeq2',
  title = 'RNA-seq analysis of differential expression using DESeq2',
  reportDirectory = &quot;./reports&quot;)
publish(dds,des2Report, pvalueCutoff=0.1,
  annotation.db=&quot;org.Mm.eg.db&quot;, factor = colData(dds)$condition,
  reportDir=&quot;./reports&quot;)
finish(des2Report)
</code></pre>

<p><strong>Other notes</strong></p>

<p>What&rsquo;s in the output file?</p>

<ul>
<li>geneid<br /></li>
<li>log2FoldChange, default fold change output by DESeq2.</li>
<li>pvalue<br /></li>
<li>padj, adjusted p value<br /></li>
<li>log2FoldChange_lfc, moderated and shrunken log2 fold changes, more
conservative (and accurate?)</li>
<li>padj_IHW, adjusted p value of independent hypothesis weighting
(smaller, which results in more differentially-expressed genes)<br /></li>
<li>genetype<br /></li>
<li>genename</li>
<li>TPM.sample, the transcript per million of the gene in the sample</li>
<li>counts.sample, the read counts of the gene in the sample</li>
</ul>


  <footer>
  
<nav class="post-nav">
  <span class="nav-prev">&larr; <a href="/en/2017/08/tmtowtdi/">TMTOWTDI</a></span>
  <span class="nav-next"><a href="/en/2017/12/lecture_notes/">Lecture Notes</a> &rarr;</span>
</nav>
<script type="text/javascript">
document.addEventListener('keyup', function(e) {
  if (e.target.nodeName.toUpperCase() != 'BODY') return;
  var url = false;
  if (e.which == 37) {  
    
    url = '\/en\/2017\/08\/tmtowtdi\/';
    
  } else if (e.which == 39) {  
    
    url = '\/en\/2017\/12\/lecture_notes\/';
    
  }
  if (url) window.location = url;
});
</script>



<section class="comments">
  <div id="disqus_thread"></div>
  <script src="/js/disqusloader.min.js"></script>
  <script>
  var disqus_config = function () {
  
    this.page.url = "https:\/\/littlebitofdata.com\/" + location.pathname;
  
  };
  (function() {
    var inIFrame = function() {
      var iframe = true;
      try { iframe = window.self !== window.top; } catch (e) {}
      return iframe;
    };
    if (inIFrame()) return;
    var disqus_js = '//https-littlebitofdata-com.disqus.com/embed.js';
    
    if (location.hash.match(/^#comment/)) {
      var d = document, s = d.createElement('script');
      s.src = disqus_js; s.async = true;
      s.setAttribute('data-timestamp', +new Date());
      (d.head || d.body).appendChild(s);
    } else {
      disqusLoader('#disqus_thread', {
        scriptUrl: disqus_js, laziness: 0, disqusConfig: disqus_config
      });
    }
  })();
  </script>
  <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</section>




<script async src="/js/center-img.js"></script>

<script async src="/js/right-quote.js"></script>

<script async src="/js/no-highlight.js"></script>

<script async src="/js/fix-footnote.js"></script>

<script async src="/js/math-code.js"></script>


<script async src="//cdn.bootcss.com/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML"></script>

  



<script src="//cdn.bootcss.com/highlight.js/9.12.0/highlight.min.js"></script>



<script src="//cdn.bootcss.com/highlight.js/9.12.0/languages/r.min.js"></script>
<script src="//cdn.bootcss.com/highlight.js/9.12.0/languages/yaml.min.js"></script>
<script src="//cdn.bootcss.com/highlight.js/9.12.0/languages/tex.min.js"></script>
<script>hljs.configure({languages: []}); hljs.initHighlightingOnLoad();</script>



  
  <hr>
  <div class="copyright">&copy; <a href="/">Hong Zheng</a> 2017 - 2021 | <a href="https://github.com/zhengh42">GitHub</a></div>
  
  </footer>
  </article>
  
<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-104890341-1', 'auto');
ga('send', 'pageview');
</script>

  </body>
</html>

