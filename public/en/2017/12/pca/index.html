<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    
    <title>Principal Components Analysis - LittleBitofData</title>
    <meta property="og:title" content="Principal Components Analysis - LittleBitofData">
    

    
      
    

    

    
    


<link href='//cdn.bootcss.com/highlight.js/9.12.0/styles/github.min.css' rel='stylesheet' type='text/css' />



    <link rel="stylesheet" href="/css/style.css" />
    <link rel="stylesheet" href="/css/fonts.css" />
    
<link rel="stylesheet" href="/css/custom.css" />

  </head>

  
  <body class="en">
    <header class="masthead">
      

<h1><a href="/"><img src="/images/logo.jpg" alt="Hong Zheng" /></a></h1>



      <nav class="menu">
        <input id="menu-check" type="checkbox" />
        <label id="menu-label" for="menu-check" class="unselectable">
          <span class="icon close-icon">✕</span>
          <span class="icon open-icon">☰</span>
          <span class="text">Menu</span>
        </label>
        <ul>
        
        
        <li><a href="/">Home</a></li>
        
        <li><a href="/en/about/">About</a></li>
        
        <li><a href="/en/">Blog</a></li>
        
        <li><a href="/en/vitae/">Vitae</a></li>
        
        <li><a href="/tags/">Tags 标签</a></li>
        
        <li><a href="/categories/">Categories 分类</a></li>
        
        <li><a href="/cn/">中文</a></li>
        
        

<li class="meu-extra"></li>



<li><a href="https://github.com/zhengh42/hong_pages/tree/master/content/en/2017-12-11-pca.md" target="_blank">Edit this page</a></li>


<li><a href="/en/index.xml" type="application/rss+xml" title="RSS feed">Subscribe</a></li>

<li><a href="http://creativecommons.org/licenses/by-nc-sa/4.0/" title="Attribution-NonCommercial-ShareAlike 4.0 International">License</a></li>


        </ul>
      </nav>
    </header>

    <article class="main">
      <header class="title">
      
<h1>Principal Components Analysis</h1>


<h3>Hong Zheng / 
2017-12-11</h3>

<hr>


      </header>





<p>Denote the data matrix as <code>$X$</code>. It is a <code>$n*p$</code> matrix with <code>$n$</code> individuals/observations as rows and <code>$p$</code> features/variables as columns.</p>

<p>Firstly, center (necessary) and scale (not required, depending on the data structure) X, so that the column means are 0s, and the column variances are 1s.</p>

<pre><code class="language-r">X &lt;- scale(X,center = T, scale = T)
</code></pre>

<p>Use any of the three functions in R to perform PCA.</p>

<pre><code class="language-r"># The centering and scaling options are still specified, although not necessary here since X has already been centered and scaled. 
X.princomp = princomp(X, cor = T, scores = T) 
X.prcomp = prcomp(X,scale. = T) 
X.svd = svd(scale(X,center=TRUE,scale=TRUE))
</code></pre>

<table>
<thead>
<tr>
<th></th>
<th>princomp()</th>
<th>prcomp()</th>
<th>svd()</th>
</tr>
</thead>

<tbody>
<tr>
<td>standard deviations of principal components</td>
<td>sdev</td>
<td>sdev</td>
<td><code>$\sqrt{(D^2/(n-1))}$</code></td>
</tr>

<tr>
<td>matrix of variable loadings</td>
<td>loadings</td>
<td>rotation</td>
<td>V</td>
</tr>

<tr>
<td>principal components</td>
<td>scores</td>
<td>x</td>
<td>U%*%D</td>
</tr>
</tbody>
</table>

<p>Note:</p>

<ul>
<li>In svd approach,

<ul>
<li>if p&gt;n, <code>$X_{n*p}=U_{n*n}D_{n*n}V_{p*n}'$</code></li>
<li>if p&lt;n, <code>$X_{n*p}=U_{n*p}D_{p*p}V_{p*p}'$</code>.</li>
</ul></li>
<li><code>$U$</code> and <code>$V$</code> has the following properties: <code>$V'V=I$</code>,  <code>$U'U=I$</code>; column sum of squares are ones.</li>
<li><code>$U$</code> has equal column variances, which is equal to <code>$\frac {1}{n-1} $</code></li>
<li>Loadings in princomp output, rotation in prcomp output, and v in svd outout are the matrix of variable loadings (columns are eigenvectors). Their row and column sum of squares are ones.</li>
</ul>

<h3 id="how-to-get-new-principle-components">How to get new principle components?</h3>

<p>These are the coordinates of the individuals/observations on the principal components.</p>

<ul>
<li>Using princomp</li>
</ul>

<pre><code class="language-r">  X.princomp$scores
# or
  X %*% X.princomp$loadings
</code></pre>

<ul>
<li>Using prcomp<br /></li>
</ul>

<pre><code class="language-r">  X.prcomp$x
# or  
  X %*% X.prcomp$rotation
</code></pre>

<ul>
<li>Using svd</li>
</ul>

<pre><code class="language-r">   X.svd$u %*% diag(X.svd$d) # UD
# or
   X %*% X.svd$v # XV
</code></pre>

<p>princomp outout has different signs with the other two.</p>

<ul>
<li><p><strong>Relevant plots</strong></p>

<pre><code class="language-r"># scatter plot of individuals on PC1 vs. PC2
plot(X.prcomp$x[,1],X.prcomp$x[,2],pch=16) 
# use factoextra package. color individuals by their groups.
fviz_pca_ind(X.prcomp,
         geom.ind = &quot;point&quot;,
         col.ind = as.factor(sample.group), 
         palette = &quot;Dark2&quot;,
         repel = F,
         addEllipses = TRUE
         )
# use factoextra package. color individuals by their cos2 values.          
fviz_pca_ind(X.prcomp,
         geom.ind = &quot;point&quot;,
         col.ind = cos2,
         gradient.cols = &quot;Dark2&quot;,
         repel = F,
         addEllipses = TRUE
         )             
</code></pre></li>
</ul>

<h3 id="how-to-get-eigenvalue-variance-explained-by-each-pc">How to get eigenvalue/variance explained by each PC?</h3>

<p>An eigenvalue &gt; 1 indicates that PCs account for more variance than accounted by one of the original variables in standardized data. This is commonly used as a cutoff point for which PCs are retained. This holds true only when the data are standardized.</p>

<ul>
<li><p>Using princomp</p>

<pre><code class="language-r">apply(X.princomp$scores,2,function(x){var(x)}) # a bit inaccurate
# or
X.princomp$sdev^2
</code></pre></li>

<li><p>Using prcomp</p>

<pre><code class="language-r">apply(X.prcomp$x,2,function(x){var(x)})
# or
X.prcomp$sdev^2
</code></pre></li>

<li><p>Using svd</p>

<pre><code class="language-r">apply(X.svd$u %*% diag(X.svd$d),2,function(x){var(x)})
# or  
X.svd$d^2/(nrow(X)-1)
</code></pre></li>

<li><p><strong>Relevant plots</strong></p></li>
</ul>

<pre><code class="language-r"># get variance explained by each PC and cumulative variance
  get_eigenvalue(X.prcomp)  
  X.prcomp.varex = 100*X.prcomp$sdev^2/sum(X.prcomp$sdev^2) # variance explained by each PC
  X.prcomp.cvarex = NULL; for(i in 1:ncol(cdat)){X.prcomp.cvarex[i] = sum(X.prcomp.varex[1:i])} # cumulative variance
# plots  
  screeplot(X.prcomp)
  fviz_eig(X.prcomp,addlabels = TRUE)
  fviz_screeplot(X.prcomp)
</code></pre>

<h3 id="how-to-get-eigenvectors">How to get eigenvectors?</h3>

<ul>
<li>Using princomp</li>
</ul>

<pre><code class="language-r">  X.princomp$loadings # Strictly speaking, they are not the real &quot;loadings&quot;. See below.
</code></pre>

<ul>
<li>Using prcomp<br /></li>
</ul>

<pre><code class="language-r">  X.prcomp$rotation
# look at variables that contribute to principal component 1  
  barplot(X.prcomp$rotation[,1]
</code></pre>

<ul>
<li>Using svd</li>
</ul>

<pre><code class="language-r">  X.svd$v
</code></pre>

<h3 id="how-to-get-loadings">How to get loadings?</h3>

<p>These are the coordinates of the features/variables on the principal components.</p>

<p>Loadings are unstandardized eigenvectors&rsquo; elements, i.e. eigenvectors endowed by corresponding component variances, or eigenvalues. They are also covariances/correlations between the original variables and the unit-scaled components.</p>

<ul>
<li>Using princomp</li>
</ul>

<pre><code class="language-r"># use get_pca_var from factoextra package
  X.princomp.var &lt;-get_pca_var(X.princomp) 
  X.princomp.var$coord
# or  
  X.princomp$loadings %*% diag(X.princomp$sdev)
</code></pre>

<ul>
<li>Using prcomp<br /></li>
</ul>

<pre><code class="language-r"># use get_pca_var from factoextra package
  X.prcomp.var &lt;-get_pca_var(X.prcomp) 
  X.prcomp.var$coord
# or  
  X.prcomp$rotation %*% diag(X.prcomp$sdev)
</code></pre>

<p>The column sum of squares of the loadings are the variances of PCs.<br />
The row sum of squares of the loadings are 1s.</p>

<p>If we square the loading matrix, we get the quality of representation for variables on the factor map (the cos2 output from <code>get_pca_var</code> function).</p>

<pre><code class="language-r">all.equal(X.prcomp.var$cos2,X.prcomp.var$coord^2)
</code></pre>

<p>The column sums of the cos2 matrix are the variances of PCs.<br />
The row sums of the cos2 matrix are 1s.</p>

<p><code>X.prcomp.var$contrib</code> contains the contributions (in percentage) of the variables to the principal components.</p>

<pre><code class="language-r"># The contribution of a variable to the first principal component is (in percentage) 
X.prcomp.var$cos2[,1] * 100 / sum(X.prcomp.var$cos2[,1]) 
</code></pre>

<ul>
<li><strong>Relevant plots</strong></li>
</ul>

<pre><code class="language-r"># look at variables that contribute to principal component 1  
# use eigenvalues
  barplot(X.prcomp$rotation[,1])
# use loadings.Same as above, only different axis scales (scaled by X.prcomp$sdev[1])
  barplot(X.prcomp.var$coord[,1]) 
# use cos2/contrib
  barplot(X.prcomp.var$cos2[,1]) 
</code></pre>

<h3 id="eigenvectors-and-eigenvalues">eigenvectors and eigenvalues</h3>

<p><a href="http://setosa.io/ev/eigenvectors-and-eigenvalues/">http://setosa.io/ev/eigenvectors-and-eigenvalues/</a></p>

<h3 id="nice-illustrations-by-ttnphns-et-al">Nice illustrations by ttnphns et.al.</h3>

<ul>
<li><strong>Variable space and subject space</strong><br />
<a href="https://stats.stackexchange.com/a/192637">https://stats.stackexchange.com/a/192637</a></li>
<li><strong>Visual explanation of Canonical correlation analysis, PCA and Linear regression</strong><br />
<a href="https://stats.stackexchange.com/a/65817">https://stats.stackexchange.com/a/65817</a></li>
<li><strong>Association measure of a variable with a PCA component (on a biplot / loading plot)</strong><br />
<a href="https://stats.stackexchange.com/a/119758">https://stats.stackexchange.com/a/119758</a></li>
<li><strong>Principal component analysis and Factor analysis</strong><br />
<a href="https://stats.stackexchange.com/a/95106">https://stats.stackexchange.com/a/95106</a></li>
<li><strong>Regression</strong><br />
<a href="https://stats.stackexchange.com/a/124892">https://stats.stackexchange.com/a/124892</a></li>
<li><strong>Theoretical and pratical explanations of biplot</strong><br />
<a href="https://stats.stackexchange.com/a/141755">https://stats.stackexchange.com/a/141755</a><br />
<a href="https://stats.stackexchange.com/a/276746">https://stats.stackexchange.com/a/276746</a></li>
<li><strong>Loadings and eigenvectors</strong><br />
<a href="https://stats.stackexchange.com/a/143949">https://stats.stackexchange.com/a/143949</a></li>
</ul>

<h3 id="more-vivid-explanation">More vivid explanation</h3>

<p><a href="https://stats.stackexchange.com/questions/2691/making-sense-of-principal-component-analysis-eigenvectors-eigenvalues/">https://stats.stackexchange.com/questions/2691/making-sense-of-principal-component-analysis-eigenvectors-eigenvalues/</a></p>

<h3 id="pca-pratical-tutorials-using-r">PCA pratical tutorials using R</h3>

<p><a href="http://www.statpower.net/Content/312/R%20Stuff/PCA.html">http://www.statpower.net/Content/312/R%20Stuff/PCA.html</a><br />
<a href="http://www.sthda.com/english/articles/31-principal-component-methods-in-r-practical-guide/112-pca-principal-component-analysis-essentials/">http://www.sthda.com/english/articles/31-principal-component-methods-in-r-practical-guide/112-pca-principal-component-analysis-essentials/</a><br />
<a href="https://rpubs.com/crazyhottommy/PCA_MDS">https://rpubs.com/crazyhottommy/PCA_MDS</a></p>


  <footer>
  
<nav class="post-nav">
  <span class="nav-prev">&larr; <a href="/en/2017/12/statsbasic/">Variance, Covariance, and Correlation</a></span>
  <span class="nav-next"><a href="/en/2018/01/python/">Python and Virtual Environment</a> &rarr;</span>
</nav>
<script type="text/javascript">
document.addEventListener('keyup', function(e) {
  if (e.target.nodeName.toUpperCase() != 'BODY') return;
  var url = false;
  if (e.which == 37) {  
    
    url = '\/en\/2017\/12\/statsbasic\/';
    
  } else if (e.which == 39) {  
    
    url = '\/en\/2018\/01\/python\/';
    
  }
  if (url) window.location = url;
});
</script>



<section class="comments">
  <div id="disqus_thread"></div>
  <script src="/js/disqusloader.min.js"></script>
  <script>
  var disqus_config = function () {
  
    this.page.url = "https:\/\/littlebitofdata.com\/" + location.pathname;
  
  };
  (function() {
    var inIFrame = function() {
      var iframe = true;
      try { iframe = window.self !== window.top; } catch (e) {}
      return iframe;
    };
    if (inIFrame()) return;
    var disqus_js = '//https-littlebitofdata-com.disqus.com/embed.js';
    
    if (location.hash.match(/^#comment/)) {
      var d = document, s = d.createElement('script');
      s.src = disqus_js; s.async = true;
      s.setAttribute('data-timestamp', +new Date());
      (d.head || d.body).appendChild(s);
    } else {
      disqusLoader('#disqus_thread', {
        scriptUrl: disqus_js, laziness: 0, disqusConfig: disqus_config
      });
    }
  })();
  </script>
  <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</section>




<script async src="/js/center-img.js"></script>

<script async src="/js/right-quote.js"></script>

<script async src="/js/no-highlight.js"></script>

<script async src="/js/fix-footnote.js"></script>

<script async src="/js/math-code.js"></script>


<script async src="//cdn.bootcss.com/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML"></script>

  



<script src="//cdn.bootcss.com/highlight.js/9.12.0/highlight.min.js"></script>



<script src="//cdn.bootcss.com/highlight.js/9.12.0/languages/r.min.js"></script>
<script src="//cdn.bootcss.com/highlight.js/9.12.0/languages/yaml.min.js"></script>
<script src="//cdn.bootcss.com/highlight.js/9.12.0/languages/tex.min.js"></script>
<script>hljs.configure({languages: []}); hljs.initHighlightingOnLoad();</script>



  
  <hr>
  <div class="copyright">&copy; <a href="/">Hong Zheng</a> 2017 - 2021 | <a href="https://github.com/zhengh42">GitHub</a></div>
  
  </footer>
  </article>
  
<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-104890341-1', 'auto');
ga('send', 'pageview');
</script>

  </body>
</html>

