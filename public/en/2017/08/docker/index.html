<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    
    <title>Docker practice - LittleBitofData</title>
    <meta property="og:title" content="Docker practice - LittleBitofData">
    

    
      
    

    

    
    


<link href='//cdn.bootcss.com/highlight.js/9.12.0/styles/github.min.css' rel='stylesheet' type='text/css' />



    <link rel="stylesheet" href="/css/style.css" />
    <link rel="stylesheet" href="/css/fonts.css" />
    
<link rel="stylesheet" href="/css/custom.css" />

  </head>

  
  <body class="en">
    <header class="masthead">
      

<h1><a href="/"><img src="/images/logo.jpg" alt="Hong Zheng" /></a></h1>



      <nav class="menu">
        <input id="menu-check" type="checkbox" />
        <label id="menu-label" for="menu-check" class="unselectable">
          <span class="icon close-icon">✕</span>
          <span class="icon open-icon">☰</span>
          <span class="text">Menu</span>
        </label>
        <ul>
        
        
        <li><a href="/">Home</a></li>
        
        <li><a href="/en/about/">About</a></li>
        
        <li><a href="/en/">Blog</a></li>
        
        <li><a href="/en/vitae/">Vitae</a></li>
        
        <li><a href="/tags/">Tags 标签</a></li>
        
        <li><a href="/categories/">Categories 分类</a></li>
        
        <li><a href="/cn/">中文</a></li>
        
        

<li class="meu-extra"></li>



<li><a href="https://github.com/zhengh42/hong_pages/tree/master/content/en/2017-08-23-docker-practise.md" target="_blank">Edit this page</a></li>


<li><a href="/en/index.xml" type="application/rss+xml" title="RSS feed">Subscribe</a></li>

<li><a href="http://creativecommons.org/licenses/by-nc-sa/4.0/" title="Attribution-NonCommercial-ShareAlike 4.0 International">License</a></li>


        </ul>
      </nav>
    </header>

    <article class="main">
      <header class="title">
      
<h1>Docker practice</h1>


<h3>Hong Zheng / 
2017-08-23</h3>

<hr>


      </header>





<h3 id="basic-commands">Basic commands</h3>

<p>Run a container from an image<br />
<code>docker run -it my_image</code><br />
The <code>-it</code> instructs Docker to allocate a pseudo-TTY connected to the container’s stdin; creating an interactive bash shell in the container.</p>

<p>Quit from a container with interactive bash shell<br />
<code>exit</code> or<br />
<code>ctrl+p</code> followed by <code>ctrl+q</code></p>

<p>Stop a container<br />
<code>docker stop my_container</code></p>

<p>Remove a container (only stopped containers can be removed)<br />
<code>docker rm my_container</code></p>

<p>Stop and remove all containers<br />
<code>docker stop $(docker ps -a -q)</code><br />
<code>docker rm $(docker ps -a -q)</code></p>

<p>Remove images<br />
<code>docker rmi my_image</code></p>

<p>List all exited containers<br />
<code>docker ps -aq -f status=exited</code></p>

<p>Remove stopped containers<br />
<code>docker ps -aq -f status=exited --no-trunc | xargs docker rm</code></p>

<p>Remove dangling/untagged images<br />
<code>docker images -q --filter dangling=true | xargs docker rmi</code></p>

<p>Remove containers created by a specific image<br />
<code>docker ps -a | grep 'my_image' | awk '{print $1}' | xargs docker rm</code></p>

<h3 id="using-existing-images-from-docker-hub">Using existing images from docker hub</h3>

<p>Take one data processing tool, <a href=https://hub.docker.com/r/librecat/catmandu/ target="_blank">catmandu</a>, for example.</p>

<p>Pull image from docker hub:<br />
<code>docker pull librecat/catmandu</code></p>

<p>Start a container from the image, and mount a local directory onto /home/catmandu/Home directory inside the container:<br />
<code>docker run -v /home/yourdirectory:/home/catmandu/Home -it librecat/catmandu</code><br />
The local directory should be writable for all users, which means, the permission triads look like &ldquo;drwxrwxrwx&rdquo;. To change the permission of the directory, use <code>chmod 777 /home/yourdirectory</code></p>

<p>If you have a file named &ldquo;test.json&rdquo; in /home/yourdirectory/, and would like to convert it to CSV format, once inside the container, you should be able to find the same file under /home/catmandu/Home/. Then:</p>

<p><code>catmandu convert JSON to CSV &lt; /home/catmandu/Home/test.json &gt; /home/catmandu/Home/test.csv</code></p>

<p>The converted file &ldquo;test.csv&rdquo; would appear in /home/yourdirectory/ as well.</p>

<h3 id="customize-dockerfile">Customize dockerfile</h3>

<p>Some example Dockerfile of commonly-used tools in bioinformatics:</p>

<p><a href=https://github.com/zhengh42/Dockerfiles target="_blank">zhengh42/Dockerfiles</a></p>

<p>Take the Dockerfile of samtools/bcftools/htslib for example:</p>

<pre><code>FROM ubuntu:16.04
MAINTAINER Hong Zheng &lt;zhengh42@stanford.edu&gt;

# Install dependencies
RUN apt-get update &amp;&amp; apt-get install -y \
  curl \
  build-essential \
  libncurses-dev \
  zlib1g-dev \
  libz-dev \
  libbz2-dev \
  liblzma-dev

# Set up
ENV SAMTOOLS_RELEASE=1.5
ENV SAMTOOLS_URL=https://github.com/samtools/samtools/releases/download/
ENV BCFTOOLS_RELEASE=1.5
ENV BCFTOOLS_URL=https://github.com/samtools/bcftools/releases/download/
ENV HTSLIB_RELEASE=1.5
ENV HTSLIB_URL=https://github.com/samtools/htslib/releases/download/
ENV DEST_DIR=/opt/

# Download; untar &amp; decompress; remove tr.bz2 file; compile &amp; install samtools; remove unnecessary files
RUN curl -SLo ${DEST_DIR}/samtools-${SAMTOOLS_RELEASE}.tar.bz2 ${SAMTOOLS_URL}/${SAMTOOLS_RELEASE}/samtools-${SAMTOOLS_RELEASE}.tar.bz2 &amp;&amp; \
  tar -xf ${DEST_DIR}/samtools-${SAMTOOLS_RELEASE}.tar.bz2 -C ${DEST_DIR} &amp;&amp; \
  rm ${DEST_DIR}/samtools-${SAMTOOLS_RELEASE}.tar.bz2 &amp;&amp; \
  cd ${DEST_DIR}/samtools-${SAMTOOLS_RELEASE} &amp;&amp; \
  ./configure &amp;&amp; \
  make &amp;&amp; \
  make install &amp;&amp; \
  rm -rf ${DEST_DIR}/samtools-${SAMTOOLS_RELEASE} &amp;&amp; \
  curl -SLo ${DEST_DIR}/bcftools-${BCFTOOLS_RELEASE}.tar.bz2 ${BCFTOOLS_URL}/${BCFTOOLS_RELEASE}/bcftools-${BCFTOOLS_RELEASE}.tar.bz2 &amp;&amp; \
  tar -xf ${DEST_DIR}/bcftools-${BCFTOOLS_RELEASE}.tar.bz2 -C ${DEST_DIR} &amp;&amp; \
  rm ${DEST_DIR}/bcftools-${BCFTOOLS_RELEASE}.tar.bz2 &amp;&amp; \
  cd ${DEST_DIR}/bcftools-${BCFTOOLS_RELEASE} &amp;&amp; \
  ./configure &amp;&amp; \
  make &amp;&amp; \
  make install &amp;&amp; \
  rm -rf ${DEST_DIR}/bcftools-${HTSLIB_RELEASE} &amp;&amp; \
  curl -SLo ${DEST_DIR}/htslib-${HTSLIB_RELEASE}.tar.bz2 ${HTSLIB_URL}/${HTSLIB_RELEASE}/htslib-${HTSLIB_RELEASE}.tar.bz2 &amp;&amp; \
  tar -xf ${DEST_DIR}/htslib-${HTSLIB_RELEASE}.tar.bz2 -C ${DEST_DIR} &amp;&amp; \
  rm ${DEST_DIR}/htslib-${HTSLIB_RELEASE}.tar.bz2 &amp;&amp; \
  cd ${DEST_DIR}/htslib-${HTSLIB_RELEASE} &amp;&amp; \
  ./configure &amp;&amp; \
  make &amp;&amp; \
  make install &amp;&amp; \
  rm -rf ${DEST_DIR}/htslib-${HTSLIB_RELEASE}

CMD [&quot;/bin/bash&quot;]
</code></pre>

<p>Build new image from the Dockerfile:<br />
<code>docker build -f samtools/1.5all/Dockerfile -t zhengh42/samtools:1.5all samtools/1.5all</code></p>

<p>After that, an image named &ldquo;zhengh42/samtools&rdquo; would appear if we run <code>docker images</code>.</p>

<p>How to use this samtools from this image?</p>

<p><code>docker run -v /home/yourdirectory:/mnt zhengh42/samtools:1.5all samtools view /mnt/yourfiles</code></p>

<p>/home/yourdirectory stores your files, and it is mounted into /mnt inside docker containers.</p>


  <footer>
  
<nav class="post-nav">
  <span class="nav-prev">&larr; <a href="/en/2017/08/solar-eclipse/">Solar Eclipse</a></span>
  <span class="nav-next"><a href="/en/2017/08/cnv_pipeline/">Detection of Copy Number Variation in Targeted Sequencing Samples</a> &rarr;</span>
</nav>
<script type="text/javascript">
document.addEventListener('keyup', function(e) {
  if (e.target.nodeName.toUpperCase() != 'BODY') return;
  var url = false;
  if (e.which == 37) {  
    
    url = '\/en\/2017\/08\/solar-eclipse\/';
    
  } else if (e.which == 39) {  
    
    url = '\/en\/2017\/08\/cnv_pipeline\/';
    
  }
  if (url) window.location = url;
});
</script>



<section class="comments">
  <div id="disqus_thread"></div>
  <script src="/js/disqusloader.min.js"></script>
  <script>
  var disqus_config = function () {
  
    this.page.url = "https:\/\/littlebitofdata.com\/" + location.pathname;
  
  };
  (function() {
    var inIFrame = function() {
      var iframe = true;
      try { iframe = window.self !== window.top; } catch (e) {}
      return iframe;
    };
    if (inIFrame()) return;
    var disqus_js = '//https-littlebitofdata-com.disqus.com/embed.js';
    
    if (location.hash.match(/^#comment/)) {
      var d = document, s = d.createElement('script');
      s.src = disqus_js; s.async = true;
      s.setAttribute('data-timestamp', +new Date());
      (d.head || d.body).appendChild(s);
    } else {
      disqusLoader('#disqus_thread', {
        scriptUrl: disqus_js, laziness: 0, disqusConfig: disqus_config
      });
    }
  })();
  </script>
  <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</section>




<script async src="/js/center-img.js"></script>

<script async src="/js/right-quote.js"></script>

<script async src="/js/no-highlight.js"></script>

<script async src="/js/fix-footnote.js"></script>

<script async src="/js/math-code.js"></script>


<script async src="//cdn.bootcss.com/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML"></script>

  



<script src="//cdn.bootcss.com/highlight.js/9.12.0/highlight.min.js"></script>



<script src="//cdn.bootcss.com/highlight.js/9.12.0/languages/r.min.js"></script>
<script src="//cdn.bootcss.com/highlight.js/9.12.0/languages/yaml.min.js"></script>
<script src="//cdn.bootcss.com/highlight.js/9.12.0/languages/tex.min.js"></script>
<script>hljs.configure({languages: []}); hljs.initHighlightingOnLoad();</script>



  
  <hr>
  <div class="copyright">&copy; <a href="/">Hong Zheng</a> 2017 - 2021 | <a href="https://github.com/zhengh42">GitHub</a></div>
  
  </footer>
  </article>
  
<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-104890341-1', 'auto');
ga('send', 'pageview');
</script>

  </body>
</html>

